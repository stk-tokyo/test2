<!DOCTYPE html>
<html lang="ja">
<head>
  <title>事前復興調査</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="style.css">
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
  <meta charset="utf-8">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #map {
      height: 80%;
      width: 80%;
    }
  </style>
</head>
<body>

<div><h1></h1></div>
<div><b>緯度経度取得</b></div>
  <div id="map"></div>
  <ul style="position:absolute; top:155px; left:930px;">
    <li><b>cnt: </b><span id="cnt"></span></li>
    <li><b>lat: </b><span id="lat"></span></li>
    <li><b>lng: </b><span id="lng"></span></li>
    <!--<li>lat_log: <span id="lat_log"></span></li>-->
  </ul>

<form style="width:350px; height:400px; position:absolute; top:300px; left:950px;">
<input type="button" value="Save as CSV file" onclick="save();" style="position:relative; top: 20px; left:-200px;">
</form>

  
  <script>
  //var table = [['cp','lat','lng']];
  //var table = [['cp','latirude', 'longitude'], ['1','36', '137']];
  var array0 = [['marker','latitude','longitude']];
  var table  = array0;

  // マップの初期化
    var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 16,
    center: {lat: str_lat, lng: str_lng}
    });
    // クリックイベントを追加
    map.addListener('click', function(e) {
      getClickLatLng(e.latLng, map);
    });

    var click_count = 0;
   
    function initMap() {
      // マップの初期化
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 16,
        center: {lat:33.462882, lng: 132.423368}
      });

      // クリックイベントを追加
      map.addListener('click', function(e) {
        getClickLatLng(e.latLng, map);
      });
    }

    function getClickLatLng(lat_lng, map) {
      click_count++;
      str_cnt = String(click_count);
      str_lat = String(lat_lng.lat());
      str_lng = String(lat_lng.lng());
      var array1 = [str_cnt, str_lat, str_lng];
      array0.push(array1);
      
      // 座標を表示
      document.getElementById('lat').textContent = lat_lng.lat();
      document.getElementById('lng').textContent = lat_lng.lng();
      document.getElementById('cnt').textContent = click_count;

      // マーカーを設置
      var marker = new google.maps.Marker({
        position: lat_lng,
        map: map
      });

      var size = new google.maps.Size( 200, 200 ) ;

      // 座標の中心をずらす
      map.panTo(lat_lng);
    }


    // CSVファイルに出力するための関数
    var downloadCsv = (function() {
      var tableToCsvString = function(table) {
          var str = '\uFEFF';
          for (var i = 0, imax = table.length - 1; i <= imax; ++i) {
              var row = table[i];
              for (var j = 0, jmax = row.length - 1; j <= jmax; ++j) {
                  str += '"' + row[j].replace('"', '""') + '"';
                  if (j !== jmax) {
                      str += ',';
                  }
              }
              str += '\n';
          }
          return str;
      };

      var createDataUriFromString = function(str) {
          return 'data:text/csv,' + encodeURIComponent(str);
      }

      var downloadDataUri = function(uri, filename) {
          var link = document.createElement('a');
          link.download = filename;
          link.href = uri;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
      };

      return function(table, filename) {
          if (!filename) {
              filename = 'output.csv';
          }
          var uri = createDataUriFromString(tableToCsvString(table));
          downloadDataUri(uri, filename);
      };
    })();


    // CSVに出力
    function save(){
      //var table = array0;
        downloadCsv(table);
    }


  </script>
  <script src="//maps.google.com/maps/api/js?key=AIzaSyBmGlUg-_VJxe_x8HCVnJAZoJPFy1tirQ4&callback=initMap" async defer></script>
</body>
</html>
